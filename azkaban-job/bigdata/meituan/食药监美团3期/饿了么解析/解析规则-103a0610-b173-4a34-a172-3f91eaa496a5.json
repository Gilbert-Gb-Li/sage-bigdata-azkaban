{"id":"103a0610-b173-4a34-a172-3f91eaa496a5","name":"食药监-饿了么数据解析入口","sample":"","parser":{"schema":" message CrawlData {\n        //数据来源：app端固定值为\"app\"\n        required string dataSource = 1;\n        //爬虫版本\n        required string spiderVersion = 2;\n        //实例的containerId\n        optional string containerId = 3;\n        //实例的cloudServiceId\n        optional string cloudServiceId = 4;\n        //用于Saver查找产生该条数据的deepLink\n        optional string resourceKey = 5;\n        //数据类型： 1为抓取的业务数据  2为dump的页面数据\n        required int32 dataType = 6;\n        //应用的包名\n        optional string appPackageName = 7;\n        //应用的版本号\n        optional string appVersion = 8;\n        //标识实际抓取的数据的具体类型，由app确定\n        required string schema = 9;\n\n        //实际数据\n        message Content {\n            //抓取时间\n            required int64 timestamp = 1;\n            //抓取的业务数据为json格式,  dump数据为xml，所有数据Gzip压缩处理，Base64编码\n            required bytes data = 2;\n        }\n        //支持批量传输\n        repeated Content content = 10;\n    }","filter":[{"field":"content","name":"extends"},{"fields":["data"],"name":"gunzip"},{"field":"schema","cases":[{"value":"shop_list","rule":{"field":"sssss","parser":{"filter":[{"field":"data","parser":{"filter":[{"field":"data","name":"extends"}],"metadata":[],"name":"json"},"ref":"392f13a1-4f4e-41d3-be1d-8c1ab9d78a57","name":"reParser"},{"script":"import java.text.SimpleDateFormat\nimport java.util.Date\nimport java.util.regex.Pattern\nimport com.haima.sage.bigdata.etl.common.model.RichMap\n\nvar result = RichMap()\nresult ++= event\n\n//补hdfs存储目录\nval currentPage_province_city = result.get(\"currentPage_province_city\").orNull\nval currentPage = currentPage_province_city.split(\"_\")(0)\nval province = currentPage_province_city.split(\"_\")(1)\nval city = currentPage_province_city.split(\"_\")(2)\n\nresult ++= Map(\"currentPage\" -> currentPage)\nresult ++= Map(\"province\" -> province)\nresult ++= Map(\"city\" -> city)\nresult","type":"scala","name":"script"},{"fields":["shop_min_order_amount","shop_rating","shop_supportSelfTaking","shop_delivery_price","shop_label_icon","shop_recent_food_popularity","categories"],"name":"removeFields"},{"fields":["current_page","restaurant_id"],"name":"removeFields"},{"fields":{"openHours":"open_time"},"name":"mapping"}],"metadata":[],"name":"json"},"ref":"804e842b-d408-416d-9ef3-9a1d8798cfc7","name":"reParser"},"name":"case"},{"value":"shop_comment_list","rule":{"field":"sssssss","parser":{"filter":[{"field":"data","parser":{"filter":[{"field":"data","name":"extends"}],"metadata":[],"name":"json"},"ref":"392f13a1-4f4e-41d3-be1d-8c1ab9d78a57","name":"reParser"},{"script":"import com.haima.sage.bigdata.etl.common.model.RichMap\n\nvar result = RichMap()\nresult ++= event\n\nvar score = result.get(\"score\").orNULL;\nif (score >2){\n    for(map <- event){\n        result --= map\n    }\n}\n\nresult","type":"scala","name":"script"},{"fields":["shop_delivery","reply_time","isSuperVip","reply_content","isTaobaoVip","shop_comment_negative","shop_comment_quality"],"name":"removeFields"},{"fields":{"shop_comment_total":"comment_total_num","order_id":"comment_id"},"name":"mapping"}],"metadata":[],"name":"json"},"ref":"ce19fb55-0023-47b0-bed3-8d3582b6e8b5","name":"reParser"},"name":"case"},{"value":"shop_info","rule":{"field":"sssssss","parser":{"filter":[{"field":"data","parser":{"filter":[{"field":"data","name":"extends"}],"metadata":[],"name":"json"},"ref":"392f13a1-4f4e-41d3-be1d-8c1ab9d78a57","name":"reParser"},{"fields":{"food_result":"local_logo","place_level":"place_grade"},"name":"mapping"},{"fields":{"administration_leve":"manage_grade","main_business_format":"business_type"},"name":"mapping"},{"fields":{"business_licence":"shop_cert_photo1","food_licence":"food_licence"},"name":"mapping"}],"metadata":[],"name":"json"},"ref":"c18f99b5-354a-4996-8a27-64d37fb175a7","name":"reParser"},"name":"case"}],"default":{"name":"drop"},"name":"redirect"}],"metadata":[],"name":"protobuf"},"properties":[],"isSample":0}